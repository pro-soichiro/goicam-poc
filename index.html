<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ã‚´ã‚¤ã‚­ãƒ£ãƒ³ - èªå½™åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
          "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f5f5f5;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      header {
        background: #2c3e50;
        color: white;
        padding: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      h1 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
      }
      .stats {
        display: flex;
        gap: 1rem;
        font-size: 0.9rem;
        flex-wrap: wrap;
        align-items: center;
      }
      .stat-item {
        display: flex;
        align-items: center;
        gap: 0.3rem;
      }
      .combo {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-weight: bold;
        animation: pulse 0.5s ease;
        box-shadow: 0 2px 8px rgba(243, 156, 18, 0.4);
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.15);
        }
      }
      .score-display {
        font-size: 1.2rem;
        font-weight: bold;
        color: #f39c12;
      }
      main {
        flex: 1;
        max-width: 600px;
        width: 100%;
        margin: 0 auto;
        padding: 1.5rem;
      }
      .card {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 1rem;
      }
      .term {
        font-size: 1.8rem;
        font-weight: bold;
        text-align: center;
        margin-bottom: 1.5rem;
        color: #2c3e50;
      }
      .choices {
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
      }
      .choice-btn {
        background: white;
        border: 2px solid #3498db;
        color: #3498db;
        padding: 1rem;
        border-radius: 6px;
        font-size: 1rem;
        cursor: pointer;
        text-align: left;
        transition: all 0.2s;
        position: relative;
      }
      .choice-btn:hover:not(:disabled) {
        background: #3498db;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
      }
      .choice-btn:focus {
        outline: 3px solid #f39c12;
        outline-offset: 2px;
      }
      .choice-btn:disabled {
        cursor: not-allowed;
        opacity: 0.6;
      }
      .choice-btn.correct {
        background: #27ae60;
        color: white;
        border-color: #27ae60;
      }
      .choice-btn.incorrect {
        background: #e74c3c;
        color: white;
        border-color: #e74c3c;
      }
      .choice-num {
        display: inline-block;
        width: 1.5rem;
        height: 1.5rem;
        border-radius: 50%;
        background: #ecf0f1;
        color: #2c3e50;
        text-align: center;
        line-height: 1.5rem;
        font-weight: bold;
        margin-right: 0.5rem;
        font-size: 0.9rem;
      }
      .choice-btn:hover:not(:disabled) .choice-num {
        background: rgba(255, 255, 255, 0.3);
        color: white;
      }
      .feedback {
        margin-top: 1.5rem;
        padding: 1rem;
        border-radius: 6px;
        display: none;
        animation: slideIn 0.3s ease-out;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .feedback.show {
        display: block;
      }
      .feedback.correct {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        border: 2px solid #27ae60;
        color: #155724;
      }
      .feedback.incorrect {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        border: 2px solid #e74c3c;
        color: #721c24;
      }
      .feedback-title {
        font-weight: bold;
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        animation: bounce 0.5s ease;
      }
      @keyframes bounce {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }
      .example {
        margin: 0.8rem 0;
        padding: 0.8rem;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 4px;
        font-size: 0.95rem;
        line-height: 1.6;
        font-style: italic;
      }
      .next-btn {
        background: #27ae60;
        color: white;
        border: none;
        padding: 0.8rem 2rem;
        border-radius: 6px;
        font-size: 1rem;
        cursor: pointer;
        margin-top: 1rem;
        width: 100%;
        transition: all 0.2s;
      }
      .next-btn:hover {
        background: #229954;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(39, 174, 96, 0.3);
      }
      .next-btn:focus {
        outline: 3px solid #f39c12;
        outline-offset: 2px;
      }
      .start-screen {
        text-align: center;
        padding: 2rem 0;
      }
      .start-screen h2 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: #2c3e50;
      }
      .daily-theme {
        display: inline-block;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        margin-bottom: 1rem;
        font-weight: bold;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }
      .start-screen p {
        color: #666;
        margin-bottom: 2rem;
        line-height: 1.8;
        font-size: 0.95rem;
      }
      .start-btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 1rem 3rem;
        border-radius: 6px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.2s;
      }
      .start-btn:hover {
        background: #2980b9;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
      }
      .start-btn:focus {
        outline: 3px solid #f39c12;
        outline-offset: 2px;
      }
      .result-screen {
        text-align: center;
        padding: 2rem 0;
      }
      .result-screen h2 {
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
        color: #2c3e50;
      }
      .result-stats {
        background: #ecf0f1;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
      }
      .result-stat {
        font-size: 1.2rem;
        margin: 0.8rem 0;
        color: #2c3e50;
      }
      .result-stat strong {
        color: #27ae60;
        font-size: 1.5rem;
      }
      .result-badge {
        display: inline-block;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 0.8rem 1.5rem;
        border-radius: 25px;
        margin: 1rem 0;
        font-size: 1.3rem;
        font-weight: bold;
        box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
        animation: bounce 0.6s ease;
      }
      .continue-tomorrow {
        margin-top: 1rem;
        padding: 1rem;
        background: #fff3cd;
        border: 2px solid #ffc107;
        border-radius: 8px;
        color: #856404;
        font-size: 0.95rem;
      }
      .reset-btn {
        background: #e74c3c;
        color: white;
        border: none;
        padding: 0.6rem 1.5rem;
        border-radius: 6px;
        font-size: 0.9rem;
        cursor: pointer;
        margin-top: 1rem;
        transition: all 0.2s;
      }
      .reset-btn:hover {
        background: #c0392b;
        transform: translateY(-1px);
      }
      .reset-btn:focus {
        outline: 3px solid #f39c12;
        outline-offset: 2px;
      }
      .review-toggle {
        margin-top: 1.5rem;
        text-align: center;
        cursor: pointer;
        color: #7f8c8d;
        font-size: 0.9rem;
        padding: 0.5rem;
        transition: color 0.2s;
      }
      .review-toggle:hover {
        color: #34495e;
      }
      .review-details {
        margin-top: 1rem;
        padding: 1.5rem;
        background: #f8f9fa;
        border-radius: 8px;
        text-align: left;
        max-height: 400px;
        overflow-y: auto;
      }
      .review-item {
        padding: 1rem;
        margin-bottom: 0.8rem;
        background: white;
        border-radius: 6px;
        border-left: 4px solid #ddd;
      }
      .review-item.correct {
        border-left-color: #27ae60;
      }
      .review-item.incorrect {
        border-left-color: #e74c3c;
      }
      .review-term {
        font-weight: bold;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: #2c3e50;
      }
      .review-answer {
        font-size: 0.95rem;
        margin: 0.3rem 0;
        color: #555;
      }
      .review-result {
        display: inline-block;
        padding: 0.2rem 0.6rem;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: bold;
        margin-left: 0.5rem;
      }
      .review-result.correct {
        background: #d4edda;
        color: #155724;
      }
      .review-result.incorrect {
        background: #f8d7da;
        color: #721c24;
      }
      .hidden {
        display: none;
      }
      .timer-bar {
        height: 4px;
        background: #ecf0f1;
        border-radius: 2px;
        overflow: hidden;
        margin-bottom: 1rem;
      }
      .timer-progress {
        height: 100%;
        background: linear-gradient(90deg, #3498db 0%, #2ecc71 100%);
        transition: width 10s linear;
        width: 100%;
      }
      footer {
        background: white;
        padding: 1rem;
        text-align: center;
        border-top: 1px solid #ddd;
        font-size: 0.9rem;
        color: #666;
      }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
      @media (max-width: 480px) {
        h1 {
          font-size: 1.2rem;
        }
        .term {
          font-size: 1.5rem;
        }
        .choice-btn {
          font-size: 0.95rem;
          padding: 0.8rem;
        }
        .start-btn {
          padding: 0.8rem 2rem;
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>ğŸ“š ã‚´ã‚¤ã‚­ãƒ£ãƒ³</h1>
      <div class="stats">
        <div class="stat-item">
          ğŸ¯ ã‚¹ã‚³ã‚¢: <span class="score-display" id="score">0</span>
        </div>
        <div class="stat-item combo hidden" id="combo-display">
          ğŸ”¥ <span id="combo">0</span> COMBO!
        </div>
        <div class="stat-item">ğŸ”¥ <strong id="streak">0</strong>æ—¥</div>
      </div>
    </header>

    <main>
      <div class="card" id="start-screen">
        <div class="start-screen">
          <div class="daily-theme" id="daily-theme">ğŸ“– ä»Šæ—¥ã®ãŠé¡Œ</div>
          <h2>5å•ã‚¯ãƒªã‚¢ã§é”æˆï¼</h2>
          <p>åˆ¶é™æ™‚é–“10ç§’ã€é€£ç¶šæ­£è§£ã§ãƒœãƒ¼ãƒŠã‚¹<br />ã‚µã‚¯ãƒƒã¨1åˆ†ã§å®Œèµ°ã—ã‚ˆã†</p>
          <div
            style="
              display: flex;
              gap: 1rem;
              margin-top: 1.5rem;
              flex-wrap: wrap;
              justify-content: center;
            "
          >
            <button
              class="start-btn"
              onclick="startQuiz('mixed')"
              style="
                flex: 1;
                min-width: 200px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              "
              onmouseover="this.style.opacity='0.9'"
              onmouseout="this.style.opacity='1'"
            >
              ãŠã¾ã‹ã›ï¼ˆæ¨å¥¨ï¼‰
            </button>
          </div>
          <div
            style="
              display: flex;
              gap: 0.5rem;
              margin-top: 0.8rem;
              flex-wrap: wrap;
              justify-content: center;
            "
          >
            <button
              class="start-btn"
              onclick="startQuiz('meaning')"
              style="
                flex: 1;
                min-width: 140px;
                font-size: 0.9rem;
                padding: 0.7rem 1.5rem;
              "
            >
              æ„å‘³ç†è§£å‹
            </button>
            <button
              class="start-btn"
              onclick="startQuiz('recall')"
              style="
                flex: 1;
                min-width: 140px;
                font-size: 0.9rem;
                padding: 0.7rem 1.5rem;
                background: #9b59b6;
              "
              onmouseover="this.style.background='#8e44ad'"
              onmouseout="this.style.background='#9b59b6'"
            >
              èªå¥æƒ³èµ·å‹
            </button>
          </div>
        </div>
      </div>

      <div class="card hidden" id="quiz-screen">
        <div class="timer-bar">
          <div class="timer-progress" id="timer-progress"></div>
        </div>
        <div class="term" id="term"></div>
        <div class="choices" id="choices"></div>
        <div
          class="feedback"
          id="feedback"
          role="status"
          aria-live="polite"
          aria-atomic="true"
        ></div>
      </div>

      <div class="card hidden" id="result-screen">
        <div class="result-screen">
          <h2>ğŸ‰ ã‚¯ãƒªã‚¢ï¼</h2>
          <div class="result-badge" id="result-badge">ğŸ† èªå½™ãƒã‚¹ã‚¿ãƒ¼</div>
          <div class="result-stats">
            <div class="result-stat">
              ç²å¾—ã‚¹ã‚³ã‚¢: <strong id="result-score">0</strong>pt
            </div>
            <div class="result-stat">
              æœ€å¤§ã‚³ãƒ³ãƒœ: <strong id="result-max-combo">0</strong>é€£ç¶š
            </div>
          </div>
          <div class="continue-tomorrow">
            â° æ˜æ—¥ã®æ–°ã—ã„ãŠé¡Œã¯ 0:00 ã«æ›´æ–°ï¼<br />
            ç¶šãã¯ã¾ãŸæ˜æ—¥ãŠæ¥½ã—ã¿ã«âœ¨
          </div>
          <div class="review-toggle" onclick="toggleReview()">
            <span id="review-toggle-text">â–¼ å›ç­”ã‚’ç¢ºèªã™ã‚‹</span>
          </div>
          <div class="review-details hidden" id="review-details"></div>
        </div>
      </div>
    </main>

    <footer id="footer">
      å¾©ç¿’æº–å‚™ä¸­...
      <div style="margin-top: 1rem">
        <button class="reset-btn" onclick="resetAllData()">
          ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>
    </footer>

    <script>
      // åˆæœŸå•é¡Œãƒ‡ãƒ¼ã‚¿
      const QUESTIONS = [
        {
          id: 1,
          term: "æ˜¯éã‚’å•ã†",
          correct: "ç‰©äº‹ã®æ­£ã—ã„ã‹æ­£ã—ããªã„ã‹ã‚’åˆ¤æ–­ã™ã‚‹",
          incorrect: [
            "çµ¶å¯¾ã«ã‚„ã‚Šé‚ã’ã‚ˆã†ã¨å¼·ãæ±‚ã‚ã‚‹",
            "å…¨åŠ›ã‚’å°½ãã—ã¦å–ã‚Šçµ„ã‚€",
            "ç›¸æ‰‹ã«ç†±å¿ƒã«ä¾é ¼ã™ã‚‹",
          ],
          recallIncorrect: ["å¿œé…¬ã™ã‚‹", "æˆå°±ã™ã‚‹", "è¨€åŠã™ã‚‹"],
          explanation: "æ˜¯ã‹éã‹ï¼æ­£ã—ã„ã‹æ­£ã—ããªã„ã‹ã‚’åˆ¤æ–­ã™ã‚‹æ„ã€‚",
          example: "ä¾‹ï¼šä¼šè­°ã§æ–°æ–¹é‡ã®æ˜¯éã‚’å•ã†å ´é¢ã¨ãªã£ãŸ",
        },
        {
          id: 2,
          term: "ç›£ç£",
          correct: "æŒ‡å°ãƒ»å–ã‚Šç· ã¾ã‚Šã‚’ã—ã¦è¦‹å®ˆã‚‹ã“ã¨",
          incorrect: [
            "å®Ÿéš›ã«ç¾å ´ã§ä½œæ¥­ã™ã‚‹ã“ã¨",
            "ä¸Šä½è€…ã«ç›¸è«‡ã—ã¦åˆ¤æ–­ã‚’ä»°ãã“ã¨",
            "è¦å‰‡ã‚’ä½œã‚Šåˆ¶åº¦åŒ–ã™ã‚‹ã“ã¨",
          ],
          recallIncorrect: ["ç®¡ç†ã™ã‚‹", "èª¿æ•´ã™ã‚‹", "çµ±åˆ¶ã™ã‚‹"],
          explanation: "æŒ‡å°ãƒ»å–ã‚Šç· ã¾ã‚Šã®ç«‹å ´ã‹ã‚‰è¦‹å®ˆã‚‹ã“ã¨ã€‚",
          example: "ä¾‹ï¼šå·¥äº‹ç¾å ´ã‚’ç›£ç£ã™ã‚‹è²¬ä»»è€…ãŒé…ç½®ã•ã‚ŒãŸ",
        },
        {
          id: 3,
          term: "ã‚¹ãƒ†ãƒ«ã‚¹ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°",
          correct: "åºƒå‘Šã¨æ°—ã¥ã‹ã‚Œãªã„å½¢ã§å•†å“ã‚’å®£ä¼ã™ã‚‹ã“ã¨",
          incorrect: [
            "æ–°ã—ã„è²©å£²æˆ¦ç•¥ã‚’é–‹ç™ºã™ã‚‹ã“ã¨",
            "æ¶ˆè²»è€…ã®è³¼è²·å‚¾å‘ã‚’åˆ†æã™ã‚‹ã“ã¨",
            "è‡ªç„¶ã«å£²ã‚Œã‚‹ä»•çµ„ã¿ã‚’ä½œã‚‹ã“ã¨",
          ],
          recallIncorrect: [
            "ãƒã‚¤ãƒ©ãƒ«ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°",
            "ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°",
            "ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°",
          ],
          explanation: "åºƒå‘Šè¡¨ç¤ºã‚’ã›ãšå®£ä¼ã™ã‚‹æ‰‹æ³•ã€‚ç•¥ç§°ã€Œã‚¹ãƒ†ãƒã€ã€‚",
          example: "ä¾‹ï¼šæœ‰åäººãŒè‡ªç„¶ã«å•†å“ã‚’ç´¹ä»‹ã—ã¦ã‚¹ãƒ†ãƒç–‘æƒ‘ãŒæµ®ä¸Š",
        },
        {
          id: 4,
          term: "ãƒãƒ„ãŒæ‚ªã„",
          correct: "æ°—ã¾ãšãã€å±…å¿ƒåœ°ãŒæ‚ªã„",
          incorrect: [
            "ä½“èª¿ãŒæ‚ªãã€èª¿å­ãŒå‡ºãªã„",
            "å¤±æ•—ã—ã¦å¤§ããªæå®³ã‚’å—ã‘ã‚‹",
            "åˆ¤æ–­ã‚’èª¤ã‚Šã€çµæœãŒä¸åˆ©ã«ãªã‚‹",
          ],
          recallIncorrect: ["æ°—ãŒé‡ã„", "é¢ç›®ãªã„", "å¿ƒè‹¦ã—ã„"],
          explanation: "ãã®å ´ã«å±…ã¥ã‚‰ã„æ„Ÿã˜ã®ã€Œæ°—ã¾ãšã•ã€ã€‚",
          example: "ä¾‹ï¼šå¶ç„¶å…ƒã‚«ãƒ¬ã«ä¼šã£ã¦ãƒãƒ„ãŒæ‚ªã„æ€ã„ã‚’ã—ãŸ",
        },
        {
          id: 5,
          term: "æ¶æ„ã™ã‚‹",
          correct: "ã‹ã‚‰ã‹ã†ã‚ˆã†ã«è¨€ã†",
          incorrect: [
            "ã‚„ã•ã—ãåŠ©è¨€ã™ã‚‹",
            "é å›ã—ã«çš®è‚‰ã‚’è¿°ã¹ã‚‹",
            "ã•ã‚Šã’ãªãç¤ºå”†ã™ã‚‹",
          ],
          recallIncorrect: ["æ‰¹è©•ã™ã‚‹", "å˜²ç¬‘ã™ã‚‹", "éé›£ã™ã‚‹"],
          explanation: "ã‹ã‚‰ã‹ã„ãƒ»ãªã¶ã‚Šã‚’å«ã‚€è¨€ã„æ–¹ã€‚",
          example: "ä¾‹ï¼šå½¼ã®å¤±æ•—ã‚’æ¶æ„ã™ã‚‹ã‚ˆã†ãªç™ºè¨€ã¯æ§ãˆã‚‹ã¹ãã ",
        },
        {
          id: 6,
          term: "ç ´è«‡ã«ãªã‚‹",
          correct: "ã¾ã¨ã¾ã‚Šã‹ã‘ã¦ã„ãŸè©±ãŒå–ã‚Šã‚„ã‚ã«ãªã‚‹",
          incorrect: [
            "è«‡è©±ãŒæ¿€ã—ããªã£ã¦å£è«–ã«ãªã‚‹",
            "ç›¸æ‰‹ã¨ç¸ã‚’åˆ‡ã£ã¦çµ¶äº¤ã™ã‚‹",
            "å˜˜ã®è©±ã§äººã‚’ã ã¾ã™",
          ],
          recallIncorrect: ["æ±ºè£‚ã™ã‚‹", "é “æŒ«ã™ã‚‹", "ç™½ç´™ã«æˆ»ã‚‹"],
          explanation: "ã¾ã¨ã¾ã‚Šã‹ã‘ã¦ã„ãŸç¸è«‡ã‚„å•†è«‡ãªã©ãŒå–ã‚Šã‚„ã‚ã«ãªã‚‹ã“ã¨ã€‚",
          example: "ä¾‹ï¼šæ¡ä»¶ãŒåˆã‚ãšã€çµå©šã®è©±ã¯ç ´è«‡ã«ãªã£ãŸ",
        },
        {
          id: 7,
          term: "ç¤ºå”†ã™ã‚‹",
          correct: "ãã‚Œã¨ãªãã»ã®ã‚ã‹ã™",
          incorrect: [
            "å¼·ãå‘½ä»¤ã—ã¦è¡Œå‹•ã‚’ä¿ƒã™",
            "æ ¹æ‹ ã‚’ç¤ºã—ã¦èª¬å¾—ã™ã‚‹",
            "è©³ç´°ã«èª¬æ˜ã—ã¦ç†è§£ã•ã›ã‚‹",
          ],
          recallIncorrect: ["æš—ç¤ºã™ã‚‹", "é™³è¿°ã™ã‚‹", "å¿œç­”ã™ã‚‹"],
          explanation: "ç›´æ¥çš„ã«è¨€ã‚ãšã€ãã‚Œã¨ãªãæ°—ã¥ã‹ã›ã‚‹ã“ã¨ã€‚",
          example: "ä¾‹ï¼šä¸Šå¸ã¯ç•°å‹•ã®å¯èƒ½æ€§ã‚’ç¤ºå”†ã™ã‚‹ã‚ˆã†ãªç™ºè¨€ã‚’ã—ãŸ",
        },
        {
          id: 8,
          term: "å¦‚å®Ÿã«",
          correct: "ã‚ã‚Šã®ã¾ã¾ã«ã€å®Ÿéš›ã®ã¨ãŠã‚Šã«",
          incorrect: [
            "ãŠãŠã’ã•ã«èª‡å¼µã—ã¦",
            "ã‚ã‹ã‚Šã‚„ã™ãç°¡ç•¥åŒ–ã—ã¦",
            "ä¸€éƒ¨ã ã‘ã‚’å¼·èª¿ã—ã¦",
          ],
          recallIncorrect: ["æ‚ ç„¶ã¨", "æŠ½è±¡çš„ã«", "è©³ç´°ã«"],
          explanation: "äº‹å®Ÿãã®ã¾ã¾ã€ã‚ã‚Šã®ã¾ã¾ã®æ„ã€‚",
          example: "ä¾‹ï¼šãƒ‡ãƒ¼ã‚¿ãŒæ¥­ç¸¾æ‚ªåŒ–ã®å®Ÿæ…‹ã‚’å¦‚å®Ÿã«ç¤ºã—ã¦ã„ã‚‹",
        },
        {
          id: 9,
          term: "é‡å®ã™ã‚‹",
          correct: "ä¾¿åˆ©ã§å½¹ã«ç«‹ã¤ã¨ã—ã¦å¤§åˆ‡ã«ä½¿ã†",
          incorrect: [
            "é«˜ä¾¡ã§æ‰‹ã«å…¥ã‚Šã«ãã„",
            "é•·ãä¿ç®¡ã—ã¦æ»…å¤šã«ä½¿ã‚ãªã„",
            "ä»–äººã«è²¸ã—ã¦ä¾¡å€¤ã‚’ä¸Šã’ã‚‹",
          ],
          recallIncorrect: ["å°Šé‡ã™ã‚‹", "æ…é‡ã«æ‰±ã†", "å°‚å¿µã™ã‚‹"],
          explanation: "ä¾¿åˆ©ã§å½¹ç«‹ã¤ã‚‚ã®ã¨ã—ã¦å¤§äº‹ã«ä½¿ã†ã“ã¨ã€‚",
          example: "ä¾‹ï¼šã“ã®ãƒ„ãƒ¼ãƒ«ã¯ä½œæ¥­åŠ¹ç‡åŒ–ã«é‡å®ã—ã¦ã„ã‚‹",
        },
        {
          id: 10,
          term: "ä¸å•ã«ä»˜ã™",
          correct: "å•é¡Œã«ã›ãšã€å’ã‚ãªã„ã“ã¨ã«ã™ã‚‹",
          incorrect: [
            "è©³ã—ãèª¿ã¹ã¦å‡¦ç½°ã™ã‚‹",
            "ã‚ã„ã¾ã„ãªã¾ã¾æ”¾ç½®ã™ã‚‹",
            "ä¸€æ™‚çš„ã«ä¸­æ­¢ã—ã¦å†æ¤œè¨ã™ã‚‹",
          ],
          recallIncorrect: ["æ–­ç½ªã™ã‚‹", "ä¿ç•™ã«ã™ã‚‹", "è³ªç–‘ã™ã‚‹"],
          explanation: "éã¡ã‚„è²¬ä»»ã‚’å•ã‚ãšã€å‡¦ç½°ã—ãªã„ã“ã¨ã€‚",
          example: "ä¾‹ï¼šåˆçŠ¯ã¨ã„ã†ã“ã¨ã§ä»Šå›ã¯ä¸å•ã«ä»˜ã™ã“ã¨ã«ã—ãŸ",
        },
      ];

      // ãƒ‡ã‚¤ãƒªãƒ¼ãƒ†ãƒ¼ãƒå€™è£œ
      const DAILY_THEMES = [
        "ğŸ“– ãƒ“ã‚¸ãƒã‚¹åŸºç¤èª",
        "ğŸ¯ èª¤ç”¨ã—ã‚„ã™ã„è¨€è‘‰",
        "âœ¨ æ•™é¤Šãƒ¯ãƒ¼ãƒ‰",
        "ğŸ’¼ æ•¬èªãƒã‚¹ã‚¿ãƒ¼",
        "ğŸ”¥ ä»Šé€±ã®å¿…ä¿®èª",
      ];

      // é–“éš”åå¾©ã®é–“éš”è¨­å®šï¼ˆæ—¥æ•°ï¼‰
      const INTERVALS = [1, 2, 4, 7, 14, 30];

      // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆ
      let currentQuestion = null;
      let currentChoices = [];
      let answered = false;
      let progress = null;
      let quizSession = null; // ç¾åœ¨ã®ã‚¯ã‚¤ã‚ºã‚»ãƒƒã‚·ãƒ§ãƒ³
      let timerInterval = null; // ã‚¿ã‚¤ãƒãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«
      let autoNextTimeout = null; // è‡ªå‹•é·ç§»ã‚¿ã‚¤ãƒãƒ¼
      let answerHistory = []; // å›ç­”å±¥æ­´
      let quizMode = "meaning"; // 'meaning' or 'recall'

      // åˆæœŸåŒ–
      function init() {
        loadProgress();
        updateStats();
        setupKeyboardShortcuts();
        showScreen("start");
        setDailyTheme();
      }

      // ãƒ‡ã‚¤ãƒªãƒ¼ãƒ†ãƒ¼ãƒã‚’è¨­å®š
      function setDailyTheme() {
        const today = new Date();
        const dayIndex = today.getDay(); // 0-6
        const theme = DAILY_THEMES[dayIndex % DAILY_THEMES.length];
        document.getElementById("daily-theme").textContent = theme;
      }

      // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
      function showScreen(screenName) {
        document.getElementById("start-screen").classList.add("hidden");
        document.getElementById("quiz-screen").classList.add("hidden");
        document.getElementById("result-screen").classList.add("hidden");

        document
          .getElementById(`${screenName}-screen`)
          .classList.remove("hidden");
      }

      // ã‚¯ã‚¤ã‚ºé–‹å§‹
      function startQuiz(mode = "meaning") {
        quizMode = mode;
        quizSession = {
          questions: [...QUESTIONS].sort(() => Math.random() - 0.5).slice(0, 5), // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦5å•ã ã‘é¸æŠ
          currentIndex: 0,
          correctCount: 0,
          score: 0,
          combo: 0,
          maxCombo: 0,
        };
        answerHistory = []; // å›ç­”å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆ
        showScreen("quiz");
        showNextQuestion();
      }

      // ã‚¹ã‚³ã‚¢æ›´æ–°
      function updateScore() {
        document.getElementById("score").textContent = quizSession.score;

        // ã‚³ãƒ³ãƒœè¡¨ç¤ºæ›´æ–°
        const comboDisplay = document.getElementById("combo-display");
        const comboText = document.getElementById("combo");

        if (quizSession.combo >= 2) {
          comboDisplay.classList.remove("hidden");
          comboText.textContent = quizSession.combo;
          // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
          comboDisplay.style.animation = "none";
          setTimeout(() => {
            comboDisplay.style.animation = "";
          }, 10);
        } else {
          comboDisplay.classList.add("hidden");
        }
      }

      // localStorageã‹ã‚‰ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚’èª­ã¿è¾¼ã¿
      function loadProgress() {
        const saved = localStorage.getItem("vocabQuizProgress");
        if (saved) {
          progress = JSON.parse(saved);
          updateStreak();
        } else {
          // åˆå›èµ·å‹•æ™‚ã®åˆæœŸåŒ–
          progress = {
            streak: 0,
            lastPlayedDate: getTodayString(),
            todayCount: 0,
            totalCorrect: 0,
            words: {},
          };
          QUESTIONS.forEach((q) => {
            progress.words[q.id] = {
              stage: 0,
              nextDue: getTodayString(),
              correct: 0,
              wrong: 0,
              mode: "meaning", // 'meaning' or 'recall'
            };
          });
          saveProgress();
        }
      }

      // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚’ä¿å­˜
      function saveProgress() {
        localStorage.setItem("vocabQuizProgress", JSON.stringify(progress));
      }

      // ä»Šæ—¥ã®æ—¥ä»˜ã‚’æ–‡å­—åˆ—ã§å–å¾—ï¼ˆYYYY-MM-DDï¼‰
      function getTodayString() {
        const today = new Date();
        return today.toISOString().split("T")[0];
      }

      // æ—¥ä»˜ã®å·®åˆ†ã‚’è¨ˆç®—ï¼ˆæ—¥æ•°ï¼‰
      function daysDiff(dateStr1, dateStr2) {
        const d1 = new Date(dateStr1);
        const d2 = new Date(dateStr2);
        return Math.floor((d2 - d1) / (1000 * 60 * 60 * 24));
      }

      // é€£ç¶šæ—¥æ•°ã‚’æ›´æ–°
      function updateStreak() {
        const today = getTodayString();
        const diff = daysDiff(progress.lastPlayedDate, today);

        if (diff === 0) {
          // åŒæ—¥å†…
          return;
        } else if (diff === 1) {
          // é€£ç¶š
          progress.streak++;
        } else if (diff > 1) {
          // é€”åˆ‡ã‚ŒãŸ
          progress.streak = 1;
        }

        progress.lastPlayedDate = today;
        progress.todayCount = 0;
      }

      // çµ±è¨ˆè¡¨ç¤ºã‚’æ›´æ–°
      function updateStats() {
        document.getElementById("streak").textContent = progress.streak;
      }

      // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
      function startTimer() {
        // æ—¢å­˜ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢
        clearTimeout(timerInterval);
        clearTimeout(autoNextTimeout);

        const timerBar = document.getElementById("timer-progress");
        timerBar.style.transition = "none";
        timerBar.style.width = "100%";

        setTimeout(() => {
          timerBar.style.transition = "width 20s linear";
          timerBar.style.width = "0%";
        }, 50);

        // 20ç§’å¾Œã«è‡ªå‹•ã§ä¸æ­£è§£æ‰±ã„
        timerInterval = setTimeout(() => {
          if (!answered) {
            autoIncorrect();
          }
        }, 20000);
      }

      // è‡ªå‹•ä¸æ­£è§£
      function autoIncorrect() {
        if (answered) return; // æ—¢ã«å›ç­”æ¸ˆã¿ãªã‚‰ä½•ã‚‚ã—ãªã„
        answered = true;
        quizSession.combo = 0;
        updateScore();

        const feedbackEl = document.getElementById("feedback");
        feedbackEl.className = "feedback show incorrect";
        feedbackEl.innerHTML = `
        <div class="feedback-title">â° ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼</div>
        <div class="example">${currentQuestion.example}</div>
        <button class="next-btn" onclick="proceedToNext()">æ¬¡ã¸ â†’</button>
      `;

        // å›ç­”å±¥æ­´ã«è¨˜éŒ²
        answerHistory.push({
          question: currentQuestion,
          userAnswer: null,
          isCorrect: false,
          isTimeout: true,
        });

        updateProgress(false);
        saveProgress();
        quizSession.currentIndex++;

        autoNextTimeout = setTimeout(() => {
          showNextQuestion();
        }, 3000);
      }

      // å•é¡Œã‚’è¡¨ç¤º
      function showNextQuestion() {
        // ã‚¯ã‚¤ã‚ºãŒçµ‚äº†ã—ã¦ã„ã‚‹ã‹ç¢ºèª
        if (quizSession.currentIndex >= quizSession.questions.length) {
          showResult();
          return;
        }

        answered = false;
        currentQuestion = quizSession.questions[quizSession.currentIndex];

        // å•é¡Œã”ã¨ã®ç¿’ç†Ÿåº¦ã«å¿œã˜ã¦å½¢å¼ã‚’æ±ºå®šï¼ˆæ··åˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆï¼‰
        let currentMode = quizMode;
        if (quizMode === "mixed") {
          const wordProgress = progress.words[currentQuestion.id];
          // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã«modeãŒãªã„å ´åˆã¯è¿½åŠ 
          if (!wordProgress.mode) {
            wordProgress.mode = "meaning";
          }
          currentMode = wordProgress.mode;
        }

        // é¸æŠè‚¢ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆå½¢å¼ã«å¿œã˜ã¦é¸æŠè‚¢ã‚’åˆ‡ã‚Šæ›¿ãˆï¼‰
        if (currentMode === "recall") {
          // èªå¥æƒ³èµ·å‹ï¼šæ„å‘³ã‚’è¡¨ç¤ºã€èªå¥ã‚’é¸æŠè‚¢ã«
          currentChoices = [
            { text: currentQuestion.term, isCorrect: true },
            ...currentQuestion.recallIncorrect.map((text) => ({
              text,
              isCorrect: false,
            })),
          ].sort(() => Math.random() - 0.5);
        } else {
          // æ„å‘³ç†è§£å‹ï¼šèªå¥ã‚’è¡¨ç¤ºã€æ„å‘³ã‚’é¸æŠè‚¢ã«
          currentChoices = [
            { text: currentQuestion.correct, isCorrect: true },
            ...currentQuestion.incorrect.map((text) => ({
              text,
              isCorrect: false,
            })),
          ].sort(() => Math.random() - 0.5);
        }

        // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ä¿å­˜ï¼ˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ä½¿ç”¨ï¼‰
        quizSession.currentQuestionMode = currentMode;

        renderQuestion();
        updateFooter();
        startTimer();
      }

      // çµæœç”»é¢ã‚’è¡¨ç¤º
      function showResult() {
        // ã™ã¹ã¦ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
        clearTimeout(timerInterval);
        clearTimeout(autoNextTimeout);

        document.getElementById("result-score").textContent = quizSession.score;
        document.getElementById("result-max-combo").textContent =
          quizSession.maxCombo;

        // ãƒãƒƒã‚¸ã‚’æ±ºå®š
        const rate =
          (quizSession.correctCount / quizSession.questions.length) * 100;
        let badge = "ğŸ‰ æŒ‘æˆ¦è€…";
        if (rate === 100) badge = "ğŸ† ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼";
        else if (rate >= 80) badge = "ğŸŒŸ èªå½™ãƒã‚¹ã‚¿ãƒ¼";
        else if (rate >= 60) badge = "âœ¨ å„ªç§€";

        document.getElementById("result-badge").textContent = badge;
        showScreen("result");
      }

      // å•é¡Œã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      function renderQuestion() {
        const currentMode = quizSession.currentQuestionMode || quizMode;

        // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã®é€šçŸ¥ã‚’è¡¨ç¤º
        const termEl = document.getElementById("term");
        if (quizMode === "mixed" && currentMode === "recall") {
          // èªå¥æƒ³èµ·å‹ã«åˆ‡ã‚Šæ›¿ã‚ã£ãŸæ™‚ã®é€šçŸ¥ã‚’ä¸€æ™‚è¡¨ç¤º
          termEl.innerHTML = `<div style="color: #9b59b6; font-size: 1rem; margin-bottom: 1rem;">ğŸ§© æ„å‘³ã‹ã‚‰èªå¥ã‚’é¸ã¶ãƒ¢ãƒ¼ãƒ‰ã§ã™</div>${currentQuestion.correct}`;
        } else if (quizMode === "mixed" && currentMode === "meaning") {
          termEl.textContent = currentQuestion.term;
        } else if (currentMode === "recall") {
          // èªå¥æƒ³èµ·å‹ï¼šæ„å‘³ã‚’è¡¨ç¤º
          termEl.textContent = currentQuestion.correct;
        } else {
          // æ„å‘³ç†è§£å‹ï¼šèªå¥ã‚’è¡¨ç¤º
          termEl.textContent = currentQuestion.term;
        }

        const choicesEl = document.getElementById("choices");
        choicesEl.innerHTML = "";

        currentChoices.forEach((choice, index) => {
          const btn = document.createElement("button");
          btn.className = "choice-btn";
          btn.innerHTML = `<span class="choice-num">${index + 1}</span>${
            choice.text
          }`;
          btn.onclick = () => checkAnswer(index);
          btn.setAttribute("data-index", index);
          choicesEl.appendChild(btn);
        });

        const feedbackEl = document.getElementById("feedback");
        feedbackEl.className = "feedback";
        feedbackEl.innerHTML = "";
      }

      // å›ç­”ã‚’ãƒã‚§ãƒƒã‚¯
      function checkAnswer(selectedIndex) {
        if (answered) return;
        answered = true;

        // ã™ã¹ã¦ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
        clearTimeout(timerInterval);
        clearTimeout(autoNextTimeout);

        const selectedChoice = currentChoices[selectedIndex];
        const isCorrect = selectedChoice.isCorrect;

        // å›ç­”å±¥æ­´ã«è¨˜éŒ²
        answerHistory.push({
          question: currentQuestion,
          userAnswer: selectedChoice.text,
          correctAnswer: currentQuestion.correct,
          isCorrect: isCorrect,
          isTimeout: false,
        });

        // ã‚¹ã‚³ã‚¢è¨ˆç®—
        if (isCorrect) {
          quizSession.correctCount++;
          quizSession.combo++;
          quizSession.maxCombo = Math.max(
            quizSession.maxCombo,
            quizSession.combo
          );

          // ã‚³ãƒ³ãƒœãƒœãƒ¼ãƒŠã‚¹è¾¼ã¿ã®ã‚¹ã‚³ã‚¢
          const baseScore = 100;
          const comboBonus = (quizSession.combo - 1) * 50;
          quizSession.score += baseScore + comboBonus;
        } else {
          quizSession.combo = 0;
        }

        updateScore();

        // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
        const buttons = document.querySelectorAll(".choice-btn");
        buttons.forEach((btn, index) => {
          btn.disabled = true;
          if (currentChoices[index].isCorrect) {
            btn.classList.add("correct");
          } else if (index === selectedIndex && !isCorrect) {
            btn.classList.add("incorrect");
          }
        });

        // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
        showFeedback(isCorrect);

        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
        updateProgress(isCorrect);
        updateStats();
        saveProgress();

        // å•é¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’é€²ã‚ã‚‹
        quizSession.currentIndex++;

        // è‡ªå‹•ã§æ¬¡ã¸ï¼ˆ0.7ç§’å¾Œï¼‰
        autoNextTimeout = setTimeout(() => {
          showNextQuestion();
        }, 3000);
      }

      // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¡¨ç¤º
      function showFeedback(isCorrect) {
        const feedbackEl = document.getElementById("feedback");
        feedbackEl.className = `feedback show ${
          isCorrect ? "correct" : "incorrect"
        }`;

        let title = isCorrect ? "âœ… æ­£è§£ï¼" : "âŒ æƒœã—ã„ï¼";

        // ã‚³ãƒ³ãƒœãƒœãƒ¼ãƒŠã‚¹è¡¨ç¤º
        let comboText = "";
        if (isCorrect && quizSession.combo >= 2) {
          const bonus = (quizSession.combo - 1) * 50;
          comboText = `<div style="color: #f39c12; font-weight: bold; margin-top: 0.5rem;">ğŸ”¥ ${quizSession.combo}é€£ç¶šï¼ +${bonus}pt</div>`;
        }

        feedbackEl.innerHTML = `
        <div class="feedback-title">${title}</div>
        ${comboText}
        <div class="example">${currentQuestion.example}</div>
        <button class="next-btn" onclick="proceedToNext()">æ¬¡ã¸ â†’</button>
      `;
      }

      // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚’æ›´æ–°ï¼ˆé–“éš”åå¾©ï¼‰
      function updateProgress(isCorrect) {
        const wordProgress = progress.words[currentQuestion.id];

        if (isCorrect) {
          wordProgress.correct++;
          progress.totalCorrect++;
          progress.todayCount++;

          // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’é€²ã‚ã‚‹
          wordProgress.stage = Math.min(
            wordProgress.stage + 1,
            INTERVALS.length - 1
          );
        } else {
          wordProgress.wrong++;
          progress.todayCount++;

          // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’æˆ»ã™
          wordProgress.stage = Math.max(wordProgress.stage - 1, 0);
        }

        // ç¿’ç†Ÿåº¦ã«å¿œã˜ã¦ãƒ¢ãƒ¼ãƒ‰ã‚’è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆï¼ˆæ··åˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®ã¿ï¼‰
        if (quizMode === "mixed") {
          const totalAttempts = wordProgress.correct + wordProgress.wrong;
          const accuracy =
            totalAttempts > 0 ? wordProgress.correct / totalAttempts : 0;

          // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã«modeãŒãªã„å ´åˆã¯è¿½åŠ 
          if (!wordProgress.mode) {
            wordProgress.mode = "meaning";
          }

          // ã‚¹ãƒ†ãƒ¼ã‚¸3ä»¥ä¸Š ã¾ãŸã¯ æ­£ç­”ç‡80%ä»¥ä¸Šã§èªå¥æƒ³èµ·å‹ã«æ˜‡æ ¼
          if (
            wordProgress.mode === "meaning" &&
            (wordProgress.stage >= 3 || accuracy >= 0.8) &&
            totalAttempts >= 3
          ) {
            wordProgress.mode = "recall";
          }

          // èªå¥æƒ³èµ·å‹ã§æ­£ç­”ç‡ãŒ60%æœªæº€ã«è½ã¡ãŸã‚‰æ„å‘³ç†è§£å‹ã«æˆ»ã™
          if (
            wordProgress.mode === "recall" &&
            accuracy < 0.6 &&
            totalAttempts >= 3
          ) {
            wordProgress.mode = "meaning";
          }
        }

        // æ¬¡å›å¾©ç¿’æ—¥ã‚’è¨ˆç®—
        const interval = INTERVALS[wordProgress.stage];
        const nextDue = new Date();
        nextDue.setDate(nextDue.getDate() + interval);
        wordProgress.nextDue = nextDue.toISOString().split("T")[0];
      }

      // ãƒ•ãƒƒã‚¿ãƒ¼æ›´æ–°
      function updateFooter() {
        const footerEl = document.getElementById("footer");

        // ã‚¯ã‚¤ã‚ºã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã¯é€²æ—ã‚’è¡¨ç¤º
        if (
          quizSession &&
          quizSession.currentIndex < quizSession.questions.length
        ) {
          const current = quizSession.currentIndex + 1;
          const total = quizSession.questions.length;
          footerEl.textContent = `ğŸ“ é€²æ—: ${current} / ${total}å•ç›®`;
        } else {
          const today = getTodayString();
          const dueCount = QUESTIONS.filter((q) => {
            return progress.words[q.id].nextDue <= today;
          }).length;

          if (dueCount > 0) {
            footerEl.textContent = `ğŸ“ ä»Šæ—¥ã®å¾©ç¿’: ${dueCount}å•`;
          } else {
            footerEl.textContent = "ğŸ‰ ä»Šæ—¥ã®å¾©ç¿’ã¯å®Œäº†ã§ã™ï¼";
          }
        }
      }

      // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
      function setupKeyboardShortcuts() {
        document.addEventListener("keydown", (e) => {
          // ã‚¯ã‚¤ã‚ºç”»é¢ã§ã®ã¿å‹•ä½œ
          const quizScreen = document.getElementById("quiz-screen");
          if (quizScreen.classList.contains("hidden")) return;

          if (!answered && ["1", "2", "3", "4"].includes(e.key)) {
            const index = parseInt(e.key) - 1;
            if (index < currentChoices.length) {
              checkAnswer(index);
            }
          }
        });
      }

      // å›ç­”ç¢ºèªã‚’ãƒˆã‚°ãƒ«
      function toggleReview() {
        const reviewDetails = document.getElementById("review-details");
        const toggleText = document.getElementById("review-toggle-text");

        if (reviewDetails.classList.contains("hidden")) {
          // è¡¨ç¤ºã™ã‚‹
          reviewDetails.classList.remove("hidden");
          toggleText.textContent = "â–² å›ç­”ã‚’é–‰ã˜ã‚‹";
          renderReviewDetails();
        } else {
          // éè¡¨ç¤ºã«ã™ã‚‹
          reviewDetails.classList.add("hidden");
          toggleText.textContent = "â–¼ å›ç­”ã‚’ç¢ºèªã™ã‚‹";
        }
      }

      // å›ç­”è©³ç´°ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      function renderReviewDetails() {
        const reviewDetails = document.getElementById("review-details");
        let html = "";

        answerHistory.forEach((item, index) => {
          const resultClass = item.isCorrect ? "correct" : "incorrect";
          const resultText = item.isCorrect ? "âœ… æ­£è§£" : "âŒ ä¸æ­£è§£";
          const userAnswerText = item.isTimeout
            ? "ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼‰"
            : `ã‚ãªãŸã®å›ç­”: ${item.userAnswer}`;

          // å½¢å¼ã«å¿œã˜ã¦è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
          let questionDisplay, correctDisplay, modeIcon;

          // æ··åˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯å•é¡Œã”ã¨ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ç¢ºèª
          let itemMode = quizMode;
          if (quizMode === "mixed") {
            const wordProgress = progress.words[item.question.id];
            itemMode =
              wordProgress && wordProgress.mode ? wordProgress.mode : "meaning";
          }

          if (itemMode === "recall") {
            questionDisplay = `æ„å‘³: ${item.question.correct}`;
            correctDisplay = `æ­£è§£: ${item.question.term}`;
            modeIcon =
              quizMode === "mixed"
                ? '<span style="color: #9b59b6; font-size: 0.85rem;">ğŸ§© æƒ³èµ·</span> '
                : "";
          } else {
            questionDisplay = `èªå¥: ${item.question.term}`;
            correctDisplay = `æ­£è§£: ${item.question.correct}`;
            modeIcon =
              quizMode === "mixed"
                ? '<span style="color: #3498db; font-size: 0.85rem;">ğŸ“– ç†è§£</span> '
                : "";
          }

          html += `
          <div class="review-item ${resultClass}">
            <div class="review-term">
              ${modeIcon}Q${index + 1}. ${questionDisplay}
              <span class="review-result ${resultClass}">${resultText}</span>
            </div>
            ${
              !item.isCorrect
                ? `<div class="review-answer">${userAnswerText}</div>`
                : ""
            }
            <div class="review-answer" style="color: #27ae60; font-weight: bold;">${correctDisplay}</div>
            <div class="review-answer" style="font-style: italic; color: #666;">${
              item.question.example
            }</div>
          </div>
        `;
        });

        reviewDetails.innerHTML = html;
      }

      // æ¬¡ã®å•é¡Œã¸é€²ã‚€ï¼ˆæ‰‹å‹•ï¼‰
      function proceedToNext() {
        // è‡ªå‹•é·ç§»ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        clearTimeout(autoNextTimeout);
        // å³åº§ã«æ¬¡ã®å•é¡Œã¸
        showNextQuestion();
      }

      // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
      function resetAllData() {
        if (
          confirm(
            "ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¹ã‚³ã‚¢ã€é€£ç¶šæ—¥æ•°ã€é€²æ—ï¼‰ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚\nã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"
          )
        ) {
          localStorage.removeItem("vocabQuizProgress");
          alert("ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã™ã€‚");
          location.reload();
        }
      }

      // èµ·å‹•æ™‚ã«åˆæœŸåŒ–
      init();
    </script>
  </body>
</html>
