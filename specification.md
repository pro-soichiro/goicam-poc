# ゴイキャン - 機能仕様書

## 1. 概要

### 1.1 アプリケーション名

**ゴイキャン** - 語彙力トレーニングアプリ

### 1.2 目的

- 日本語語彙を 4 択クイズ形式で学習
- TikTok 的な中毒性を持つ短時間学習体験
- スコア・コンボによる即時フィードバックで「快感」を提供

### 1.3 コアコンセプト

- **1 セッション = 5 問 ≤ 2 分** で完結
- **自動遷移（0.7 秒）** でテンポよく進む
- **20 秒タイマー** で文章を読む時間を確保
- **コンボシステム** でゲーム性を付与
- **デイリーお題** で継続を促す
- **適応型難易度調整** で自然な学習ステップアップ

---

## 2. 画面構成

### 2.1 画面遷移フロー

```
起動 → スタート画面（形式選択） → クイズ画面（5問ループ） → 結果画面
                          ↑______________________________|
```

### 2.2 画面一覧

#### 2.2.1 スタート画面

- **表示要素**

  - デイリーテーマバッジ（例：「📖 ビジネス基礎語」）
  - タイトル：「5 問クリアで達成！」
  - 説明文：「制限時間 20 秒、連続正解でボーナス / サクッと 2 分で完走しよう」
  - クイズ形式選択ボタン（3 種類）
    - **おまかせ（推奨）**：適応型モード（紫グラデーション、大きめ）
    - **意味理解型**：語句を見て意味を選ぶ（青色ボタン、小さめ）
    - **語句想起型**：意味を見て語句を選ぶ（紫色ボタン、小さめ）

- **デイリーテーマ**
  - 曜日に応じて表示（7 パターン）
  - テーマ候補：
    1. 📖 ビジネス基礎語
    2. 🎯 誤用しやすい言葉
    3. ✨ 教養ワード
    4. 💼 敬語マスター
    5. 🔥 今週の必修語
    6. （6, 7 は上記からローテーション）

#### 2.2.2 クイズ画面

- **表示要素**

  - タイマーバー（画面上部、10 秒で減少）
  - 問題文（形式に応じて切り替わる）
    - **意味理解型**：語句を表示（例：「是非を問う」）
    - **語句想起型**：意味を表示（例：「物事の正しいか正しくないかを判断する」）
    - **適応型（想起モード時）**：モード通知表示（「🧩 意味から語句を選ぶモードです」）
  - 4 択ボタン（1〜4 の番号付き）
    - **意味理解型**：意味の選択肢
    - **語句想起型**：語句の選択肢
    - **適応型**：語句ごとの習熟度に応じて切り替わる
  - フィードバックエリア（回答後に表示）

- **タイマー仕様**

  - 問題表示と同時に 20 秒タイマー開始
  - 視覚的にバーが減少
  - 20 秒経過で自動的に不正解扱い

- **回答フロー**

  1. ユーザーが選択肢をクリック（or 1〜4 キー）
  2. タイマー停止
  3. 正解ボタンを緑、誤答ボタンを赤で表示
  4. フィードバック表示（正解/不正解 + 例文 + コンボボーナス）
  5. 0.7 秒後に自動で次の問題へ

- **キーボード操作**
  - 1〜4 キー：選択肢を選択

#### 2.2.3 結果画面

- **表示要素**
  - タイトル：「🎉 クリア！」
  - バッジ（成績に応じて変化）
    - 100%：🏆 パーフェクト！
    - 80%以上：🌟 語彙マスター
    - 60%以上：✨ 優秀
    - それ以外：🎉 挑戦者
  - 獲得スコア
  - 最大コンボ数
  - 明日のお題告知メッセージ
  - 回答確認トグル（オプション）
  - 回答詳細エリア（トグルで展開）

---

## 3. データ構造

### 3.1 問題データ（QUESTIONS 配列）

```javascript
{
  id: Number,              // 問題ID（一意）
  term: String,            // 出題用語
  correct: String,         // 正解選択肢（意味）
  incorrect: [String],     // 意味理解型の誤答選択肢（3つ）
  recallIncorrect: [String], // 語句想起型の誤答選択肢（3つ）
  explanation: String,     // 解説文
  example: String          // 用例文（「例：」で始まる）
}
```

**現在の問題数**: 10 問（5 問ずつランダムに出題）

**出題形式による使い分け**:

- **意味理解型**: `term`を問題文に、`correct`と`incorrect`を選択肢に使用
- **語句想起型**: `correct`を問題文に、`term`と`recallIncorrect`を選択肢に使用

### 3.2 クイズセッション（quizSession）

```javascript
{
  questions: [Question],  // シャッフルされた5問
  currentIndex: Number,   // 現在の問題番号（0〜4）
  correctCount: Number,   // 正解数
  score: Number,          // 合計スコア
  combo: Number,          // 現在のコンボ数
  maxCombo: Number,       // 最大コンボ数
  mode: String            // クイズ形式: 'meaning', 'recall', 'mixed'
}
```

### 3.3 回答履歴（answerHistory 配列）

```javascript
{
  question: Question,     // 問題データ
  userAnswer: String|null,// ユーザーの回答（nullはタイムアップ）
  correctAnswer: String,  // 正解
  isCorrect: Boolean,     // 正誤
  isTimeout: Boolean      // タイムアップか
}
```

### 3.4 進捗データ（localStorage: vocabQuizProgress）

```javascript
{
  streak: Number,              // 連続日数
  lastPlayedDate: String,      // 最終プレイ日（YYYY-MM-DD）
  todayCount: Number,          // 今日の回答数
  totalCorrect: Number,        // 累計正答数
  words: {
    [questionId]: {
      stage: Number,           // 習熟度ステージ（0〜5）
      nextDue: String,         // 次回復習日（YYYY-MM-DD）
      correct: Number,         // 正解回数
      wrong: Number,           // 誤答回数
      mode: String             // 適応型モードでの出題形式: 'meaning' or 'recall'
    }
  }
}
```

---

## 4. スコアリングシステム

### 4.1 基本スコア

- 正解：100pt
- 不正解/タイムアップ：0pt

### 4.2 コンボボーナス

- **コンボ**: 連続正解数
- **ボーナス**: (コンボ数 - 1) × 50pt
- 例：
  - 1 問目正解：100pt（コンボ 1）
  - 2 問目正解：150pt（100 + 50、コンボ 2）
  - 3 問目正解：200pt（100 + 100、コンボ 3）
  - 4 問目不正解：0pt、コンボリセット
  - 5 問目正解：100pt（コンボ 1）

### 4.3 コンボ表示

- コンボ 2 以上でヘッダーに表示：「🔥 X COMBO!」
- パルスアニメーションで強調

---

## 5. 間隔反復（SR）システム

### 5.1 ステージと復習間隔

```
stage 0 → 1日後
stage 1 → 2日後
stage 2 → 4日後
stage 3 → 7日後
stage 4 → 14日後
stage 5 → 30日後
```

### 5.2 ステージ更新ロジック

- **正解時**: stage = min(stage + 1, 5)
- **不正解時**: stage = max(stage - 1, 0)

### 5.3 出題優先順位

1. nextDue <= 今日の問題を優先
2. 該当なしの場合、全問題からランダム

---

## 6. 適応型難易度調整システム

### 6.1 概要

「おまかせ（推奨）」モードでは、各語句の習熟度に応じて出題形式が自動的に切り替わります。初期は意味理解型で安心感を提供し、習熟度が上がると語句想起型に移行して成長を実感させます。

### 6.2 モード切り替えロジック

#### 6.2.1 初期状態

- 新規語句は全て **意味理解型** (`mode: 'meaning'`) からスタート

#### 6.2.2 アップグレード条件（意味理解型 → 語句想起型）

以下のいずれかを満たす場合、**語句想起型** (`mode: 'recall'`) に移行：

- **条件 A**: `stage >= 3`（ステージ 3 以上）
- **条件 B**: 正答率 >= 80% **かつ** 合計回答数 >= 3

#### 6.2.3 ダウングレード条件（語句想起型 → 意味理解型）

以下を満たす場合、**意味理解型** (`mode: 'meaning'`) に戻る：

- 正答率 < 60% **かつ** 合計回答数 >= 3

#### 6.2.4 計算式

```javascript
totalAttempts = wordProgress.correct + wordProgress.wrong;
accuracy = totalAttempts > 0 ? wordProgress.correct / totalAttempts : 0;

// アップグレード判定
if (wordProgress.mode === "meaning") {
  if ((stage >= 3 || accuracy >= 0.8) && totalAttempts >= 3) {
    wordProgress.mode = "recall";
  }
}

// ダウングレード判定
if (wordProgress.mode === "recall") {
  if (accuracy < 0.6 && totalAttempts >= 3) {
    wordProgress.mode = "meaning";
  }
}
```

### 6.3 ユーザーへの通知

- **語句想起型に切り替わった時**: 問題文の上部に「🧩 意味から語句を選ぶモードです」と紫色で表示
- **結果画面の回答確認**: 各問題に対して以下のバッジを表示
  - 🧩 想起（語句想起型で出題された問題）
  - 📖 理解（意味理解型で出題された問題）

### 6.4 設計意図

- **初期の安心感**: 意味理解型で「読んで理解する」安心感を提供
- **自然なステップアップ**: 習熟度や正答率に応じて自動的に難易度が上がる
- **成長の実感**: モード通知により、自分の成長を可視化
- **柔軟な調整**: 正答率が下がればモードを戻し、挫折を防ぐ
- **語句ごとの個別管理**: 語句単位でモードを管理し、得意不得意に対応

---

## 7. UI/UX の重要ポイント

### 7.1 タイミング制御

- **問題表示**: 即座
- **回答後のフィードバック表示**: 即座
- **次の問題への自動遷移**: 0.7 秒後
- **タイムアップ後の遷移**: 0.7 秒後

### 7.2 アニメーション

- **フィードバック**: スライドイン + バウンス
- **コンボ表示**: パルス（拡大縮小）
- **タイマーバー**: 20 秒かけて線形減少
- **正解ボタン**: 緑背景に変化
- **不正解ボタン**: 赤背景に変化

### 7.3 色彩設計

- **正解**: #27ae60（緑）
- **不正解**: #e74c3c（赤）
- **コンボ**: #f39c12（オレンジ）
- **プライマリ**: #3498db（青）
- **アクセント**: #667eea〜#764ba2（紫グラデーション）

### 7.4 フィードバック内容

- **正解時**:

  - 「✅ 正解！」
  - コンボ 2 以上: 「🔥 X 連続！ +XXpt」
  - 例文表示

- **不正解時**:

  - 「❌ 惜しい！」
  - 例文表示

- **タイムアップ時**:
  - 「⏰ タイムアップ！」
  - 例文表示

---

## 8. 機能詳細

### 8.1 データリセット機能

- **場所**: フッター
- **動作**:
  1. ボタンクリック
  2. 確認ダイアログ表示
  3. OK 時、localStorage を削除
  4. ページリロード

### 8.2 回答確認機能

- **場所**: 結果画面下部
- **デフォルト**: 非表示
- **トグル**: 「▼ 回答を確認する」／「▲ 回答を閉じる」
- **表示内容**（各問題ごと）:
  - 問題番号と用語
  - 正誤バッジ
  - ユーザーの回答（不正解時のみ）
  - 正解
  - 例文

### 8.3 ヘッダー表示

- **常時表示**:

  - アプリ名：「📚 ゴイキャン」
  - スコア：「🎯 スコア: XXXpt」
  - 連続日数：「🔥 X 日」

- **クイズ中のみ**:
  - コンボ表示：「🔥 X COMBO!」（2 連続以上）

### 8.4 フッター表示

- **スタート画面**:

  - 「📝 今日の復習: X 問」（due な問題数）
  - または「🎉 今日の復習は完了です！」

- **クイズ画面**:

  - 「📝 進捗: X / 5 問目」

- **結果画面**:

  - 「🎉 今日の復習は完了です！」

- **全画面共通**:
  - データリセットボタン

---

## 9. 技術要件

### 9.1 実装制約

- **単一ファイル**: index.html のみ
- **外部依存なし**: ライブラリ不使用
- **オフライン動作**: すべてブラウザ内で完結
- **ストレージ**: localStorage のみ

### 9.2 ブラウザ対応

- モダンブラウザ（Chrome, Firefox, Safari, Edge 最新版）
- モバイル対応必須（レスポンシブデザイン）

### 9.3 パフォーマンス

- 即座のフィードバック（遅延なし）
- アニメーションは 60fps 維持
- localStorage 操作は非同期的に感じさせない

---

## 10. 拡張性の考慮

### 10.1 問題の追加

- QUESTIONS 配列に追加するだけで動作
- 現在 10 問 → 将来的に 100 問以上を想定

### 10.2 出題ロジックの変更

- 現在：5 問ランダム出題
- 将来：SR 優先 + デイリーテーマ別出題も可能

### 10.3 スコアリングの調整

- 基本点、コンボボーナスは定数化
- 時間ボーナス追加も可能（タイマー残り時間）

---

## 11. エラーハンドリング

### 11.1 localStorage エラー

- 読み込み失敗時：初期データで起動
- 書き込み失敗時：サイレントに無視（アラート等は出さない）

### 11.2 タイマー衝突

- 既存タイマーは常にクリアしてから新規設定
- `clearTimeout()` を適切に呼び出す

### 11.3 二重実行防止

- `answered` フラグで回答後の操作を無効化
- タイマー ID を管理して重複実行を防ぐ

---

## 12. UX 原則

### 12.1 即座性

- ユーザーの操作に対して即座に反応
- ローディング時間はゼロ

### 12.2 自動化

- 「次へ」ボタンを押す必要なし
- 0.7 秒で自動遷移

### 12.3 軽快さ

- 1 セッション 1 分以内
- テンポを重視

### 12.4 物足りなさ

- 「もう終わり？」と思わせる長さ
- 明日への期待を持たせる

### 12.5 オプショナル詳細

- 復習は見たい人だけ
- 押し付けない

---

## 13. 実装チェックリスト

### 13.1 必須機能

- [ ] クイズ形式選択（おまかせ / 意味理解型 / 語句想起型）
- [ ] 適応型難易度調整（語句ごとのモード管理）
- [ ] モード切り替え通知表示
- [ ] 5 問ランダム出題
- [ ] 10 秒タイマー
- [ ] スコア・コンボ計算
- [ ] 自動遷移（0.7 秒）
- [ ] デイリーテーマ表示
- [ ] 結果画面
- [ ] 回答確認トグル（形式に応じた表示）
- [ ] データリセット
- [ ] localStorage 保存

### 13.2 UX 要件

- [ ] タイマーバーのアニメーション
- [ ] フィードバックのアニメーション
- [ ] コンボ表示のパルス
- [ ] 正解/不正解の色分け
- [ ] キーボード操作対応
- [ ] レスポンシブデザイン

### 13.3 データ整合性

- [ ] タイマー衝突の防止
- [ ] 二重回答の防止
- [ ] ステージ更新の正確性
- [ ] 連続日数の正確な計算

---

## 14. 用語集

- **セッション**: スタートから結果画面までの 1 サイクル
- **コンボ**: 連続正解数
- **ステージ**: SR（間隔反復）の習熟度レベル
- **due**: 復習期限が来ている状態
- **タイムアップ**: 10 秒以内に回答しなかった状態
- **意味理解型**: 語句を見て意味を選ぶ形式（理解度チェック）
- **語句想起型**: 意味を見て語句を選ぶ形式（産出能力チェック）
- **適応型（おまかせ）**: 語句ごとの習熟度に応じて自動で形式が切り替わるモード

---

## 15. 参考：現在の問題リスト

### 15.1 語彙一覧

1. 是非を問う
2. 監督
3. ステルスマーケティング
4. バツが悪い
5. 揶揄する
6. 破談になる
7. 示唆する
8. 如実に
9. 重宝する
10. 不問に付す

### 15.2 語句想起型の誤答例

各語句には 3 つの語句想起型誤答選択肢が設定されています。

**例：「是非を問う」の場合**

- 意味理解型誤答：「絶対にやり遂げようと強く求める」など（意味）
- 語句想起型誤答：「応酬する」「成就する」「言及する」（語句）

---

## 付録 A: CSS 設計の要点

### A.1 カラーパレット

```css
--primary: #3498db
--success: #27ae60
--danger: #e74c3c
--warning: #f39c12
--purple-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%)
--orange-gradient: linear-gradient(135deg, #f39c12 0%, #e67e22 100%)
```

### A.2 重要なアニメーション

```css
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes bounce {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

@keyframes pulse {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.15);
  }
}
```

---

## 付録 B: JavaScript 主要関数一覧

| 関数名                      | 役割                                                           |
| --------------------------- | -------------------------------------------------------------- |
| `init()`                    | アプリ初期化                                                   |
| `startQuiz(mode)`           | クイズセッション開始（mode: 'meaning', 'recall', 'mixed'）     |
| `showNextQuestion()`        | 次の問題を表示（適応型の場合は語句ごとのモード判定）           |
| `renderQuestion()`          | 問題をレンダリング（形式に応じた表示切り替え、モード通知含む） |
| `checkAnswer(index)`        | 回答チェック                                                   |
| `startTimer()`              | 20 秒タイマー開始                                              |
| `autoIncorrect()`           | タイムアップ処理                                               |
| `showResult()`              | 結果画面表示                                                   |
| `updateScore()`             | スコア・コンボ更新                                             |
| `updateProgress(isCorrect)` | SR 進捗更新 + 適応型モード切り替え判定                         |
| `toggleReview()`            | 回答確認トグル                                                 |
| `renderReviewDetails()`     | 回答詳細レンダリング（形式・モードバッジ表示）                 |
| `resetAllData()`            | データリセット                                                 |

---

**仕様書バージョン**: 1.2
**最終更新日**: 2025 年（適応型難易度調整機能追加）
**作成者**: ゴイキャン POC プロジェクト
